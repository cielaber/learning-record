# 数据库系统

## 数据库模式

美国国家标准协会(American National Standard Institute, ANSI)的数据库管理系统研究小组于1978年提出了标准化的建议，将数据库结构分为3级：面向用户或应用程序员的用户级、面向建立和维护数据库人员的概念级、面向系统程序员的物理级。

![image-20250603175243734](.\images\image-20250603175243734.png)

数据按外模式的描述提供给用户；按内模式的描述存储在磁盘上；而概念模式提供了连接这两级模式的相对稳定的中间层，并使得两级中任意一级的改变都不受另一级的牵制。

### 数据独立性

数据的独立性是指数据与程序独立，将数据的定义从程序中分离出来，由DBMS（数据库管理系统）负责数据的存储，从而简化应用程序，大大减少应用程序编制的工作量。

数据库的三级模式结构和二级映射是数据库系统实现数据独立性的核心设计理念。

**数据的物理独立性**

数据的物理独立性是指当数据库的内模式发生改变时，数据的的逻辑结构不变。由于应用程序处理的只是数据的逻辑结构，这样物理独立性可以保证，当数据的物理结构改变了，应用程序不用改变。

但是，为了保证应用程序能够正确执行，需要修改概念模式/内模式之间的映像。

**数据的逻辑独立性**

数据的逻辑独立性是指用户的应用程序与数据库结构是相互独立的。数据的逻辑结构发生变化后，用户程序也可以不修改。

但是，为了保证应用程序能够正确执行，需要修改外模式/概念模式之间的映像。

### 三级模式

#### 概念模式

概念模式又称模式或逻辑模式，对应于概念级。它是由数据库设计者综合所有用户的数据，按照统一的观点构造的全局逻辑结构，是对数据库中全部数据的逻辑结构和特征的总体描述，是所有用户的公共数据视图(全局视图)。它是由数据库管理系统提供的数据模式描述语言(Data Description Language，DDL)来描述、定义的。

模式处于三级结构的中间层，不涉及数据的物理存储细节和硬件环境，与具体的应用程序、所使用的应用开发工具及高级程序设计语言无关。一个数据库只有一个模式，因为它是整个数据库数据在逻辑上的视图，即是数据库的整体逻辑。

例如：学生信息管理系统的模式定义了`学生表(学号, 姓名, 性别, 出生日期, 院系)`、`课程表(课程号, 课程名, 学分)`、`选课表(学号, 课程号, 成绩)`等结构及其关系。

#### 外模式

外模式又称子模式或用户模式，对应于用户级。它是某个或某几个用户所看到的数据库的数据视图，是与某一应用有关的数据的逻辑表示。外模式是从模式导出的一个子集，包含模式中允许特定用户使用的那部分数据。用户可以通过外模式描述语言来描述、定义对应于用户的数据记录(外模式)，也可以利用数据操纵语言(Data Manipulation Language，DML)对这些数据记录进行操作。

例如，一个学生信息管理系统中：

- 学生本人登录后看到的视图可能只包含他自己的基本信息、选课成绩（外模式1）。
- 教务处老师看到的视图可能包含所有学生的信息、所有课程信息、教师信息（外模式2）。
- 财务处看到的视图可能只包含学生的学号、姓名、缴费状态（外模式3）。

#### 内模式

内模式又称存储模式，对应于物理级。它是数据库中全体数据的内部表示或底层描述，是数据库最低一级的逻辑描述，它描述了数据在存储介质上的存储方式和物理结构，对应着实际存储在外存储介质上的数据库。内模式由内模式描述语言来描述、定义的。

例如，内模式规定：

- `学生表`的数据存储在名为`student.dat`的文件中，按`学号`升序组织成B+树结构。
- 在`姓名`字段上建立一个辅助的哈希索引。
- 每条记录采用定长格式存储。
- 数据块大小为4KB。

### 两级映射

#### 外模式-概念模式的映射

模式描述的是数据的全局逻辑结构，外模式描述的是数据的局部逻辑结构。数据库中的同一模式可以有任意多个外模式，对于每个外模式，都存在一个外模式/模式映像，它确定了数据的局部逻辑结构与全局逻辑结构之间的对应关系。

当概念模式（全局逻辑结构）发生改变时（如增加一个新字段、修改字段类型），数据库管理员(DBA)可以通过修改这个映射关系，使得外模式（用户视图）保持不变。这样，依赖于该外模式的应用程序就不需要修改。

保证了逻辑数据独立性 (Logical Data Independence) - 应用程序不受全局逻辑结构变化的影响。

例如：在`学生表`的模式中，需要将`姓名`字段拆分成`姓氏`和`名字`两个字段（比如为了支持国际化需求）。

传统文件系统做法：所有读取或写入`姓名`字段的程序都必须修改代码，以适应新的两个字段结构。工作量巨大！

数据库三级模式做法：

1. DBA 修改概念模式：将`学生表`定义改为`(学号, 姓氏, 名字, 性别, 出生日期, 院系)`。
2. DBA 修改相关的外模式/概念模式映射。
   1. 对于只需要`姓名`（原样显示）的外模式：映射中定义 `姓名 = 姓氏 + ' ' + 名字`。这样，该外模式看到的仍然是一个叫`姓名`的字段，内容由拼接而成。
   2. 对于需要区分姓氏和名字的外模式：映射直接暴露新的`姓氏`和`名字`字段。
3. 那些只使用旧`姓名`字段的外模式（及其对应的应用程序）完全不需要修改，因为映射保证了它们看到的视图没有变化（还是那个拼接好的`姓名`字段）。依赖于能看到新字段的外模式的程序才需要修改。

全局逻辑结构（概念模式）变了，但很多应用程序（通过外模式访问）完全不受影响。程序独立于数据的逻辑结构变化。

#### 概念模式-内模式的映射

数据库中的模式和内模式只有一个，所以模式/内模式映像是唯一的。它确定了数据的全局逻辑结构与储存逻辑结构之间的对应关系。

当内模式（物理存储结构）发生改变时（如更换存储设备、改变文件组织方式、创建新的索引），DBA可以通过修改这个映射关系，使得概念模式（全局逻辑结构）保持不变。这样，所有的外模式和应用程序都不需要修改。

保证了物理数据独立性 (Physical Data Independence) - 应用程序和全局逻辑结构不受物理存储变化的影响。

例如：为了提高查询性能，DBA决定为`选课表`在`成绩`字段上创建一个新的B+树索引，并将数据文件从硬盘A迁移到更快的固态硬盘B上。

传统文件系统做法：如果程序直接操作文件路径和访问方法（如顺序扫描），那么：

- 程序可能需要修改文件路径指向硬盘B。
- 如果程序原本依赖顺序扫描，现在想利用新索引加速，必须修改程序代码来使用新的索引访问方式。

数据库三级模式做法：

1. DBA 修改内模式：
   - 更新索引定义（增加`成绩`索引）。
   - 更改`选课表`数据文件的物理位置（指向硬盘B上的新文件）。
   - （可能）调整文件组织方式。
2. DBA 修改概念模式/内模式映射：将新的物理存储细节（文件位置、索引）映射到原有的逻辑模式`选课表(学号, 课程号, 成绩)`上。
3. 概念模式（逻辑结构）保持不变！所有外模式自然也保持不变。应用程序发出的SQL查询（如`SELECT * FROM 选课表 WHERE 成绩 > 90;`）完全不需要修改。数据库管理系统(DBMS)会自动通过更新后的模式/内模式映射找到新的索引和文件位置，优化查询执行路径。

物理存储结构（内模式）发生了重大变化（迁移存储、新增索引），但应用程序完全感知不到，也不需要做任何修改。DBMS利用映射自动处理了物理细节。程序独立于数据的物理存储变化。

## 分布式数据库

分布式数据库（Distributed Database）一种将数据分布存储在多个物理上分散的数据库单元中，并通过网络将这些数据单元组成的逻辑上的统一整体的数据库系统。它的核心思想是将数据分布在多个节点上，每个节点可以独立处理一部分数据，且各个节点之间可以协同工作，共同完成用户的存储和处理操作。

分布式数据库系统的设计目标主要包括：性能、可扩展性、高可用性、容错性和一致性。通过将数据分布在多个节点上，分布式数据库可以通过增加节点来扩展系统的存储和计算能力，解决单机数据库在处理海量数据时的性能瓶颈。此外，分布式数据库还通过冗余和副本机制提高了系统的容错性和可靠性，确保即使某些节点出现故障，系统仍能正常工作。

**特点**

- 数据独立性。除了数据的逻辑独立性和物理独立性外，分布式数据库还有数据分布式独立的特点。
- 集中与自治共享结合的控制结构。各局部的DBMS可以独立地管理局部数据库，具有自治的功能。同时，系统又设有集中控制机制，协调各局部DBMS的工作，执行全局应用。
- 适当增加数据冗余度。在不同的场地存储同一数据的多个副本，可以适当提高系统的可靠性和可用性，同时也能提高系统性能。即当系统中某个节点发生故障时，由于数据存在副本，对其他地方来说，数据仍然是可用的，从而保证数据的完备性。
- 全局一致性、可串行性和可恢复性

**劣势**

- 通信开销大，故障率高
- 数据的存取结构复杂
- 数据的安全性和保密性难以控制
- 数据一致性和事务处理复杂

### 分布式数据库管理系统DDBMS

![image-20250603185854088](.\images\image-20250603185854088.png)

分布式数据库管理系统（Distributed Database Management System，简称DDBMS）是一种在计算机网络上由多台计算机共同参与数据的管理的系统。这种系统允许数据分布在不同的物理位置，但对用户来说，操作和访问就像使用一个单一的数据库一样。 

分布式数据库管理系统的基本功能包括接受用户请求、访问网络数据字典、执行分布式处理、在用户和局部DBMS之间进行协调，以及在异构环境中提供数据和进程移植的支持。

**组成**

- 局部数据库管理系统LDBMS
- 全局数据库管理系统GDBMS
- 全局数据字典
- 通信管理CM

**结构**

- 全局控制集中的DDBMS
- 全局控制分散的DDBMS
- 全局控制部分分散的DDBMS

透明性

### 透明性

透明性是分布式数据库的属性，通过它，分布的内部细节对用户隐藏。 DDBMS 设计者可以选择对表进行分段、复制分段并将它们存储在不同的站点。 然而，由于用户忽略了这些细节，他们发现分布式数据库像任何集中式数据库一样易于使用。

#### 逻辑透明性

逻辑透明性，也称局部映像透明性，指的是用户无需关心不必关心局部DBMS支持哪种数据模型、使用哪种数据操纵语言，系统会通过逻辑层来统一处理。也就是说，用户在访问数据时，系统会将其视为一个逻辑上的整体，而不需要知道数据是分布在多个位置、设备或节点上的，也不需要知道各个局部具体的细节。这种透明性对用户来说非常重要，因为它提供了一个简洁、统一的视图。

例如，在分布式数据库中，用户可以像在单一数据库中一样查询数据，而不需要关心数据是存储在不同服务器上以及不同服务器上的存储结构和方式，或者如何通过不同的计算节点来处理查询。

#### 分片透明性

分片透明性指的是数据在数据库中如何进行分片（即将数据拆分到多个部分）对用户来说是透明的。分片通常是为了提高查询效率和负载均衡。分片透明性保证了应用程序在访问数据库时，不需要关心数据是如何被分割的，以及每个分片的具体内容。

例如，在一个分布式数据库中，数据表可能被分成多个部分（分片），用户在进行查询时，系统自动根据规则决定哪些分片包含需要的数据，用户无需显式地指定查询哪个分片。

数据分片有如下三种方式：

- 水平分片：按照数据内容进行分片，比如按照数据的地域属性进行将数据进行分布到不同的地方。
- 垂直分片：按照数据结构进行分片，比如按照字段将不同字段数据分布在到不同的地方。
- 混合分片：水平分片和垂直分片同时使用。

#### 位置透明性

位置透明性意味着用户不需要知道数据的实际存储位置，也就是数据的物理位置对用户是完全透明的。在分布式数据库中，数据可以分布在不同的服务器或地理位置，用户和应用程序在访问数据时，完全不需要考虑这些数据存储在哪里。

例如，用户查询数据时，不需要知道数据是存储在纽约的服务器还是在东京的服务器。无论数据的存放位置如何，用户看到的结果是一样的。

#### 复制透明性

复制透明性意味着用户和应用程序不需要知道数据是否被复制，复制的数据是透明的。分布式数据库中，数据可能会被复制到多个节点或服务器，以确保高可用性、容错性和负载均衡。复制透明性保证了在数据复制的情况下，用户无需关心复制的机制或副本的数量。 

例如，如果一个数据库的某个数据项被复制到多个位置，用户无论是访问主副本还是副本，都能够得到一致的结果。系统会自动处理读写请求的路由，而用户不需要关心具体的复制策略。

### 两阶段提交协议-2PC

二阶段提交(Two-phaseCommit)是指，在计算机网络以及数据库领域内，为了使基于分布式系统架构下的所有节点在进行事务提交时保持一致性而设计的一种算法(Algorithm)。通常，二阶段提交也被称为是一种协议(Protocol))。

在分布式系统中，每个节点虽然可以知晓自己的操作时成功或者失败，却无法知道其他节点的操作的成功或失败。

当一个事务跨越多个节点时**，**为了保持事务的ACID特性，需要引入一个作为协调者的组件来统一掌控所有节点(称作参与者)的操作结果并最终指示这些节点是否要把操作结果进行真正的提交(比如将更新后的数据写入磁盘等等)。

因此，二阶段提交的算法思路可以概括为：参与者将操作成败通知协调者，再由协调者根据所有参与者的反馈情报决定各参与者是否要提交操作还是中止操作。

两个阶段是指：

- voting phase **投票阶段**：该阶段，协调者将通知事务参与者准备提交或取消事务，然后进入表决过程。在表决过程中，参与者将告知协调者自己的决策：同意（事务参与者本地作业执行成功）或取消（本地作业执行故障）。
- commit phase **提交阶段**：该阶段，协调者将基于第一个阶段的投票结果进行决策：提交或取消。当且仅当所有的参与者同意提交事务协调者才通知所有的参与者提交事务，否则协调者将通知所有的参与者取消事务。参与者在接收到协调者发来的消息后将执行响应的操作。

> 三阶段提交（Three-phase commit），也叫三阶段提交协议（Three-phase commit protocol），是二阶段提交（2PC）的改进版本。
>
> 与两阶段提交不同的是，三阶段提交有两个改动点。
>
> - 引入超时机制。同时在协调者和参与者中都引入超时机制。
> - 在第一阶段和第二阶段中插入一个准备阶段，主要是为了在预执行之前，确保所有参与者都具备可执行条件，从而减少资源浪费，保证了在最后提交阶段之前各参与节点状态的一致。
>
> 相对于2PC，3PC主要解决的单点故障问题，并减少阻塞。

**例题**

![image-20250603195102586](.\images\image-20250603195102586.png)

答案：D

![image-20250603195218029](.\images\image-20250603195218029.png)

答案：D

![image-20250603195311707](.\images\image-20250603195311707.png)

答案：C

## 数据库设计过程

数据库设计是一个系统化的过程，涉及多个阶段，每个阶段都有其特定的任务和目标。这个过程确保了数据库系统的有效性、效率和可扩展性。

![image-20250604105643845](.\images\image-20250604105643845.png)

**需求分析**

在需求分析阶段，设计者需要与用户进行沟通，了解用户的数据需求、功能需求和性能需求。这一步是整个数据库设计过程中最为关键的部分，因为它为后续的设计工作奠定了基础。需求分析通常采用结构化分析方法，通过数据流图和数据字典来描述系统中的数据和处理过程。

它产生关键文档：

- 用户的数据模型 (User's Data Model / Conceptual Model)：一个独立于任何具体数据库管理系统 (DBMS) 的概念模型，专注于描述业务实体、属性及其之间的关系。实体关系模型 (ER Model)是表达这个概念模型最常用、最直观的工具。
- 数据流图 (Data Flow Diagram - DFD)：图形化地展示数据在系统内的流动路径、处理过程（加工）、存储位置（数据存储）以及与外部实体（如读者、图书管理员）的交互。它侧重于数据处理流程。
- 数据字典 (Data Dictionary)：一个集中存储关于数据本身信息的仓库。它详细定义系统中涉及的所有数据项的名称、含义、数据类型、长度、取值范围、所属实体/关系、约束条件等。它是系统数据的“元数据”库。
- 需求说明书 (Requirement Specification)：将上述分析结果（数据要求、处理要求、概念模型、数据流、数据定义）整理成一份正式、详细的文档，作为后续设计和开发的基础和验收标准。

例如：以图书馆管理系统为例

- 识别出核心实体：`图书`、`读者`、`借阅记录`。定义属性：
  - `图书`(书号, 书名, 作者, ISBN, 出版社, 出版年, 分类号, 总库存, 可借库存)
  - `读者`(读者证号, 姓名, 电话, 邮箱, 注册日期, 状态)
  - `借阅记录`(借阅ID, 书号, 读者证号, 借出日期, 应还日期, 实际归还日期, 状态)

- 数据流图：绘制读者借书、还书、查询图书信息、管理员添加新书等场景下的数据流动和处理步骤。例如，“借书处理”会接收“读者证号”和“书号”输入，访问“读者信息”和“图书信息”数据存储，进行验证，然后创建“借阅记录”并更新“图书信息”中的可借库存。
- 数据字典：
  - 数据项：`书号` - 定义：图书唯一标识符；类型：字符型；长度：10；约束：主键，非空。
  - 数据项：`可借库存` - 定义：当前可供借阅的该图书数量；类型：整数；范围：>=0；约束：非空。
  - 数据项：`应还日期` - 定义：读者应归还图书的日期；类型：日期型；约束：非空，必须晚于`借出日期`。
- 需求说明书：明确说明系统必须能存储哪些数据，支持哪些操作（如借书、还书、查询、管理图书/读者信息），以及相关的业务规则（如借阅期限30天、最多借5本）。

**概念结构设计**

概念结构设计阶段是将用户需求转化为一个与特定数据库管理系统（DBMS）无关的概念模型。这通常涉及到使用E-R模型来定义实体、属性和它们之间的关系，并绘制E-R图。概念结构设计可以采用自顶向下或自底向上的方法，或者两者的结合。

例如：

绘制出`图书`、`读者`、`借阅记录`三个实体及其属性和关系的ER图。明确`借阅记录`是解决`读者`和`图书`多对多关系的关键实体。确定主键（书号、读者证号、借阅ID）和外键（借阅记录中的书号关联图书，读者证号关联读者）。

![image-20250604110820886](.\images\image-20250604110820886.png)

**逻辑结构设计**

逻辑结构设计阶段涉及将概念模型转换为DBMS支持的数据模型，并对其进行优化。这一阶段中，E-R图转换成表是一个关键步骤，它涉及到确定表的属性和主键，以及解决可能存在的属性冲突、命名冲突和结构冲突。这一过程涉及到规则转换和规范化理论。

主要活动包括：

- 应用转换规则： 将ER模型中的实体、属性、关系映射成关系数据库中的表、列、主键、外键。
- 应用规范化理论：对初步得到的关系模式进行分析和优化（分解），主要目标是消除数据冗余（如重复存储作者信息）和避免更新异常（插入、删除、修改异常），达到较高的范式（如第三范式3NF或Boyce-Codd范式BCNF）。核心是函数依赖分析。
- 输出关系模式 (Relational Schema)：最终得到一组定义良好的表结构，包括表名、列名、数据类型、主键、外键。
- 定义视图 (Views)：基于基础表创建的虚拟表，用于简化复杂查询、提供数据安全访问控制（如只给读者看到自己的借阅记录视图）。
- 定义完整性约束 (Integrity Constraints)：包括实体完整性（主键非空且唯一）、参照完整性（外键必须引用有效的主键值）、用户定义的完整性（如`可借库存 >= 0`， `应还日期 > 借出日期`）。
- 应用处理说明书 (Application Processing Specification)：更详细地描述如何在逻辑模型上实现需求分析中定义的各项数据处理操作（增删改查及复杂逻辑），可能会涉及到初步的SQL语句设计或存储过程/函数规划。

例如：

转换规则应用：

- `图书` 实体 → `Books` 表 (BookID(PK), Title, Author, ISBN, Publisher, PubYear, Category, TotalCopies, AvailableCopies)
- `读者` 实体 → `Readers` 表 (ReaderID(PK), Name, Phone, Email, RegDate, Status)
- `借阅记录` 实体 → `Loans` 表 (LoanID(PK), BookID(FK), ReaderID(FK), BorrowDate, DueDate, ReturnDate, Status) (外键BookID引用Books.BookID, ReaderID引用Readers.ReaderID)

规范化：

假设`Books`表初步设计包含`Author`和`AuthorNationality`。如果同一作者有多本书，国籍信息会重复存储（冗余）。若作者国籍改变，需要更新多条记录（修改异常）。如果某作者最后一本书被删除，其国籍信息也会丢失（删除异常）。因此，可能需要分解成：`Books`(BookID, Title, *AuthorID*, ISBN, Publisher, PubYear, Category, TotalCopies, AvailableCopies) 和 `Authors`(AuthorID(PK), AuthorName, Nationality)。

完整性约束：

- 主键约束：`Books.BookID`, `Readers.ReaderID`, `Loans.LoanID`。
- 外键约束：`Loans.BookID` REFERENCES `Books(BookID)`, `Loans.ReaderID` REFERENCES `Readers(ReaderID)`。
- 检查约束：`Books.AvailableCopies >= 0 AND Books.AvailableCopies <= Books.TotalCopies`, `Loans.DueDate > Loans.BorrowDate`。

**物理设计阶段**

物理设计阶段是为逻辑数据模型选择一个最适合应用环境的物理结构，包括存储结构和存取方法，主要关注性能和存储效率。这一阶段需要对事务进行详细分析，了解所用DBMS的内部特征，选择合适的索引方法、聚簇方法和HASH方法。

核心任务包括：

- 选择文件组织方式：决定表数据在磁盘上的物理存储结构（堆文件、索引文件、哈希文件等）。
- 设计存取路径：主要为表设计索引。决定在哪些列上创建索引（如`Books.Title`, `Readers.Name`, `Loans.DueDate`）、创建什么类型的索引（B树、位图、哈希、全文索引等）、是否创建聚簇索引。
- 确定数据存放位置：如果DBMS和存储系统支持，决定将不同的表或索引放在不同的磁盘或分区上，以平衡I/O负载。
- 设计物理块大小、缓冲区大小等参数：根据硬件和DBMS配置优化。
- 考虑冗余与分区：在性能要求极高时，可能违反规范化引入可控冗余（如将常用查询结果物化到表中）。对于超大表，考虑分区（Range, Hash, List）。
- 安全性、备份恢复策略：设计用户权限、加密、备份计划等。

影响因素：

- DBMS特性 (DBMS Features)：不同DBMS（如MySQL, PostgreSQL, Oracle, SQL Server）支持的存储引擎、索引类型、分区方式、优化器特性等各不相同。
- 硬件、OS特性 (Hardware, OS Features)：CPU性能、内存大小、磁盘类型（HDD/SSD）及速度、RAID配置、操作系统文件系统特性等直接影响物理设计选择。

例如：

- 索引设计：
  - 在`Books.Title`, `Books.AuthorID`（如果分表了）, `Books.ISBN`上创建B树索引，加速按书名/作者/ISBN查询。
  - 在`Readers.Name`, `Readers.Phone`上创建索引，加速按姓名/电话查找读者。
  - 在`Loans.ReaderID`, `Loans.BookID`, `Loans.DueDate`上创建索引。`(ReaderID, DueDate)`的复合索引对快速查找某读者的所有未还书（状态为On Loan且DueDate < Today）至关重要。`(BookID)`索引对查找某书的借阅历史有用。
  - 考虑在`Loans`表的`DueDate`上创建索引，方便查找所有即将到期或已超期的借阅。
- 存储：如果表非常大（如百万级借阅记录），考虑对`Loans`表按`BorrowDate`进行范围分区（如按月或年分区）。
- 硬件/OS：使用SSD硬盘存放`Loans`表和索引，因为这是高频读写表。确保服务器有足够内存容纳常用索引和热点数据。

**例题**

![image-20250604112513221](.\images\image-20250604112513221.png)

答案：C

![image-20250604112644421](.\images\image-20250604112644421.png)

答案：C

### 概念结构设计

![image-20250604131305599](.\images\image-20250604131305599.png)

局部E-R图集成为整体E-R图的方法：

- 多个局部E-R图一次集成。
- 逐步集成，用累加的方式一次集成两个局部E-R图。

集成产生的冲突及解决办法：

- 属性冲突：包括属性域冲突和属性取值冲突。
- 命名冲突：包括同名异义和异命同义。
- 结构冲突：包括同一对象在不同应用中具有不同的抽象，以及同一实体在不同局部E-R图中所包含的属性个数和属性排列次序不完全相同。

### 逻辑结构设计

![image-20250604152432366](.\images\image-20250604152432366.png)

详细过程如下：

- E-R图向关系模式的转换
  - 实体向关系模式的转换
  - 联系向关系模式的转换
- 关系模式的规范化
- 确定完整性约束（保证数据的正确性）
- 用户视图的确定（提高数据的安全性和独立性）
  - 根据数据流图确定处理过程使用的视图
  - 根据用户类别确定不同用户使用的视图
- 应用程序设计

#### 数据模型

数据模型三要素：

- 数据结构：描述数据的组织形式，例如层次、网状或二维表。
- 数据操作：定义对数据的增删改查操作。
- 数据的约束条件：确保数据库中的数据符合特定的规则和规范。

典型的数据模型有如下三种：

- 层次模型：层次模型是一种树形结构，类似于文件系统中的目录结构。
- 网状模型：网状模型允许一个节点有多个父节点，形成复杂的网状结构。它克服了层次模型无法表示非层次关系的缺点。
- 面向对象模型
- 关系模型：关系模型是目前最主流的数据库模型。

#### 关系模型

##### 关系模型的表示方法

![image-20250604135014593](.\images\image-20250604135014593.png)

![image-20250604134815427](.\images\image-20250604134815427.png)

![image-20250604134905502](.\images\image-20250604134905502.png)

##### 关系模型相关概念

**目或度**

关系模式中属性的个数。

**候选键/候选码**

关系中能唯一标志一个元组且没有冗余的最小属性集。

候选键是一个集合，其中每个候选键可能有一个或多个属性组成，构成候选键的每个属性称为主属性。

若一个关系有多个候选键，则可以选择其中一个作为主键，多个属性组合成的候选键也可以作为主键。

**主键/主码**

多个候选码，则选定其中一个为主码。主码不允许为空值(非零和空格)。

**主属性与非主属性**

组成候选码的属性就是主属性，其他就是非主属性。

**外键/外码**

在某个关系中包含另一个关系的主键所对应的属性或属性组。

**全码/全键**

若关系只有一个候选键，且这个候选键包含了关系的所有属性，称该候选键为全键。

#### 完整性约束

**实体完整性约束**

规定基本关系的主属性唯一且非空。

**参照完整性约束**

它反映关系与关系间的引用。外键要么是其他关系的主键，要么是空值（未赋值或者删除）。

**用户自定义完整性约束**

它反映某一具体应用所涉及的数据必须满足的语义要求，由应用环境/程序自定义。如年龄限制，考试成绩限制等。

> 另外，触发器属于复杂完整性约束。

**例题**

![image-20250604141435793](.\images\image-20250604141435793.png)

答案：B

![image-20250604141542783](.\images\image-20250604141542783.png)

答案：C

#### E-R图转换关系模型

- 一个实体类型必须转换为一个关系模式。
- 联系也需要转换成一个关系模式。

联系转换为关系模式按照联系类型分为如下可能：

![image-20250604153238353](.\images\image-20250604153238353.png)

1. 一对一联系的转换有两种方式：
   1. 独立关系：并入两端主键及联系自身的属性，形成一个独立关系，其中主键可以是任意一端的主键。
   2. 并入实体：可以将任意一端主键及联系自身的属性并入另一端实体的关系模式，从而不新增关系模式，主键保持不变。
2. 一对多联系的转换有两种方式：
   1. 独立关系：并入两端主键以及联系自身的属性，主键为多端实体的主键。
   2. 并入实体：可以将一端并入到多端关系模式中，不新增新的关系模式，主键不变，多端作为主键。
3. 多对多的关系模式只有一种
   1. 独立关系：并入两端或多端主键及联系自身的属性，形成新的关系模式，主键是两端或多端的组合键。

**例题**

![image-20250604161923694](.\images\image-20250604161923694.png)

答案：C

ABC三个实体分别单独形成一个关系模式，多对多的联系生成一种独立的关系模式。

![image-20250604162120179](.\images\image-20250604162120179.png)

答案：D、C、A

#### 关系代数

关系代数是针对关系模式做的代数运算。常见的有：

- 并：两者元组之和去除重复行
- 交：两者重复行
- 差：前者去除二者重复行
- 笛卡尔积：两个关系中所有有序对元组集合，个数为两个元组个数之积。
- 投影：关系R上的投影是从R中选择出若干属性列组成新的关系。
- 选择：在关系中选择满足给定条件的元组。
- 自然连接：结果列数为二者属性列数之和減去重复列,行数为二者冋名属性列其值相冋的结果元组。

![image-20250604182754512](.\images\image-20250604182754512.png)

![image-20250604182851746](.\images\image-20250604182851746.png)

![image-20250604183657684](.\images\image-20250604183657684.png)

**例题**

![image-20250604184013174](.\images\image-20250604184013174.png)

答案：D、C

![image-20250604184115786](.\images\image-20250604184115786.png)

答案：D

这题有问题，E4与其他三个表达式并不等价，由于关系R和关系S存在A2和A3两个相同列，E4如果要实现与其他三个相同的效果还需要一步σR.A2=S.A2，由于E4少了这一步查询，所以实际效率要比其他三个高，如果将这个条件加上，实际上是E2的效率最高。

![image-20250604184747297](.\images\image-20250604184747297.png)

答案：B、C