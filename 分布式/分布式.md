# 分布式

### CAP理论

- 数据一致性（consistency）：如果系统队一个写操作返回成功，那么之后的读请求都必须读到这个新数据，如果返回失败，那么所有读操作都不能读到这个数据，对于调用者而言数据具有强一致性。
- 服务可用性（availability）：所有读写请求在一定时间内得到响应，可终止，不会一直等待。
- 分区容错性（partition-tolerance）：在网络分区的情况下，被分隔的节点仍能正常对外服务。

在分布式系统中，CAP不能同时满足，由于P是客观存在的，所以CA只能选其一。

### Base理论

Base理论是CAP理论的一种妥协，由于CA只能二取其一，Base理论降低了发生分区容错时对于可用性和一致性的要求。

- 基本可用：允许可用性降低（可能响应延长，可能服务降级等等）。
- 软状态：指允许系统中的数据存在状态，并认为该中间状态不会影响系统整体可用性。
- 最终一致性：节点数据同步可以存在时延，但在一定的期限后必定达成数据的一致，状态变为最终态。

### 数据一致性模型

- 强一致性
- 弱一致性
- 最终一致性
- 因果一致性
- 会话一致性

### 选举算法：Quorum机制、WARO

WARO：一种简单的副本控制协议，写操作时只有当所有的副本都更新成功之后，这次写操作才算成功，否则视为失败。优先保证读，任何读到的数据都是最新数据，牺牲了更新服务的可用性，只要一个副本宕机了，写服务就不会成功。但只要有一个节点存活，仍能提供读服务。

WARO描述的就是CAP中的数据一致性要求。

Quorum机制：10个副本，一次成功更新了三个，那么至少需要读取8个副本的数据，可以保证读到了最新的数据。无法保证强一致性，也就是无法实现任何时刻任何用户或者节点都可以读到最近一次成功提交的副本数据，需要配合一个获取最新成功提交的版本号的metadata服务，这样可以确定最新已经成功提交的版 本号，然后从已经读区到的数据中就可以确认最新写入的数据。

### paxos算法

是一个强一致性算法思想，不是一个真正的解决方案。

### raft算法

### zab协议

### 负载均衡策略

- 轮询
- 加权轮询 
- 随机
- 加权随机
- 源地址哈希法
- 最小连接数法